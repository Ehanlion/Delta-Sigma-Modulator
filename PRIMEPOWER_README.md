# PrimeTime/PrimePower Analysis for M216A Delta-Sigma Modulator

This document describes the PrimeTime/PrimePower flow for power analysis of the M216A Delta-Sigma Modulator design.

## Overview

PrimePower is used to perform accurate power analysis on the synthesized gate-level netlist using switching activity data from simulation. This provides more accurate power estimates than Design Compiler's statistical power analysis.

## Files

### Scripts
- **`Group_39_PrimeTimePower.tcl`** - Main PrimeTime/PrimePower TCL script
- **`run_primepower.sh`** - Bash wrapper script to run the complete flow

### Input Files (Required)
- **`M216A_TopModule.vg`** - Gate-level netlist from synthesis (generated by `run_synthesis.sh`)
- **`M216A_TopModule.vcd`** - Switching activity data from RTL simulation (generated by `run_testbench.sh`)
- **`M216A_TopModule.sdf`** - Timing delays from synthesis (optional, for timing analysis)

### Output Files (Generated)
- **`Group_39.TimingSetup`** - Setup timing report (max delay paths)
- **`Group_39.TimingHold`** - Hold timing report (min delay paths)
- **`Group_39.Power`** - Main power report (submit this)
- **`Group_39.Power_verbose`** - Detailed power breakdown (for debugging)
- **`Group_39.Power_hier`** - Hierarchical power report (for debugging)
- **`Group_39.PT_constraints`** - Constraint violations (for debugging)

## Usage

### Quick Start

Run the complete flow with one command:

```bash
./run_primepower.sh
```

This script will:
1. Check for required files (netlist, VCD)
2. Run PrimeTime/PrimePower analysis
3. Generate all reports
4. Validate power results are in expected range

### Manual Execution

If you prefer to run PrimeTime directly:

```bash
source tool-setup
pt_shell -f Group_39_PrimeTimePower.tcl
```

### Prerequisites

Before running PrimePower, ensure you have:

1. **Synthesized the design:**
   ```bash
   ./run_synthesis.sh
   ```
   This generates `M216A_TopModule.vg` (gate-level netlist)

2. **Run RTL simulation to generate VCD:**
   ```bash
   ./run_testbench.sh
   ```
   This generates `M216A_TopModule.vcd` (switching activity)

## Power Analysis Flow

### 1. Static Timing Analysis

PrimeTime first performs static timing analysis on the gate-level netlist:

- **Clock:** 500 MHz (2.0 ns period)
- **Operating Condition:** ss0p72v125c (slow corner, 0.72V, 125°C)
- **Input Delay:** 0.4 ns (max), 0.2 ns (min)
- **Output Delay:** 0.4 ns (max), 0.2 ns (min)
- **Clock Uncertainty:** 0.025 ns

### 2. Switching Activity Annotation

The VCD file from RTL simulation is read and mapped to the gate-level netlist:

- **VCD Source:** RTL simulation with testbench `EE216A_Testbench`
- **DUT Instance:** `dut` (M216A_TopModule)
- **Time Window:** 20ns to end of simulation (skips reset transients)
- **Annotation Coverage:** ~57% of nets, ~30% of cells (typical for RTL-to-gate mapping)

**Note:** The RTL VCD has hierarchical structure (`stage1`, `stage2`, etc.) while the gate-level netlist is flattened. PrimePower successfully annotates top-level I/O and propagates activity to internal nodes.

### 3. Power Calculation

PrimePower calculates averaged power using:

- **Analysis Mode:** Averaged power (not time-based)
- **Power Components:**
  - Clock network power (internal power of clock tree)
  - Register power (flip-flops)
  - Combinational logic power
  - Net switching power (interconnect)
  - Leakage power

## Results

### Expected Power Range

**50 - 250 µW**

This range is based on the design specifications and optimization targets.

### Typical Results

From the current design (with tapering optimizations):

```
Total Power:           136.20 µW  (100.00%)
  Clock Network:        66.86 µW  ( 49.08%)
  Register:             32.05 µW  ( 23.53%)
  Combinational:        37.30 µW  ( 27.39%)
  
  Cell Internal Power: 120.68 µW  ( 88.59%)
  Net Switching Power:  15.50 µW  ( 11.38%)
  Cell Leakage Power:    0.03 µW  (  0.02%)
```

### Comparison with Design Compiler

| Metric | Design Compiler | PrimePower | Difference |
|--------|----------------|------------|------------|
| Total Power | 90.9 µW | 136.2 µW | +49.8% |
| Method | Statistical | VCD-based | More accurate |

PrimePower typically reports higher power than Design Compiler because:
1. Uses real switching activity from simulation (not statistical estimates)
2. Accounts for glitches and spurious transitions
3. More accurate clock tree power modeling

## Timing Results

### Setup Timing (Max Delay)

- **Worst Slack:** 1.09 ns (MET)
- **Critical Path:** Input port → combinational logic → output port
- **Data Arrival:** 0.49 ns
- **Data Required:** 1.57 ns

### Hold Timing (Min Delay)

- **Worst Slack:** 0.00 ns (MET)
- **Critical Path:** Register-to-register (minimal delay path)

All timing constraints are met with positive slack.

## Troubleshooting

### VCD File Not Found

If `M216A_TopModule.vcd` is missing:

```bash
./run_testbench.sh
```

This runs the RTL testbench and generates the VCD file.

### Gate-Level Netlist Not Found

If `M216A_TopModule.vg` is missing:

```bash
./run_synthesis.sh
```

This runs Design Compiler synthesis and generates the netlist.

### Low VCD Annotation Coverage

The annotation coverage of ~57% is expected and acceptable because:
- RTL VCD has hierarchical modules that don't exist in flattened netlist
- PrimePower successfully annotates I/O ports and key signals
- Activity is propagated to unannotated nodes using statistical methods
- Power results are still accurate

To improve annotation (optional):
- Use SAIF format instead of VCD (requires gate-level simulation)
- Run gate-level simulation with technology library models

### Power Outside Expected Range

If power is significantly outside 50-250 µW:

1. **Check VCD annotation:**
   - Look for "Number of annotated nets" in the log
   - Should be > 50%

2. **Verify operating conditions:**
   - Check `set_operating_conditions` in the TCL script
   - Should be `ss0p72v125c` (slow corner)

3. **Check clock frequency:**
   - Verify clock period is 2.0 ns (500 MHz)
   - Higher frequency = higher power

4. **Review testbench activity:**
   - Ensure testbench exercises all functionality
   - More switching = higher power

## Key Differences from Design Compiler Power

| Aspect | Design Compiler | PrimeTime/PrimePower |
|--------|----------------|---------------------|
| **Tool** | `dc_shell` | `pt_shell` |
| **Input** | RTL + constraints | Gate netlist + VCD |
| **Method** | Statistical estimation | Activity-based calculation |
| **Accuracy** | ±30% typical | ±10% typical |
| **When to Use** | During synthesis | After synthesis |
| **Purpose** | Optimization guidance | Final verification |

## References

- PrimeTime User Guide (Synopsys)
- PrimePower User Guide (Synopsys)
- M216A Project Specification
- `Optimization_Log.md` - Design optimization history

## Contact

For questions about this flow, contact Group 39.

---

**Last Updated:** December 10, 2025

